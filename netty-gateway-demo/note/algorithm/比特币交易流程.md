### 前置知识
- **非对称加密**：也叫公开密钥加密，它是通过密码学的算法生成一对公私钥，公钥对外公开，私钥由本人保管。
  它有两个用途：
  1. 他人可以将数据用公开的公钥加密后传输给公钥持有人，公钥持有人使用对应的私钥将数据解密，
     读取信息，通过这种方式，可以保证信息传输的安全性；
  2. 公钥持有人可以使用私钥对信息签名（签名过程类似加密过程），然后将信息和签名一起发送给他人，
     他人可以通过公钥对信息签名进行验证（验证过程类似解密过程），验证签名信息与发送信息一致，则证明信息是由公钥持有人发出，
     可以在不暴露公钥持有人身份和私钥的情况下，确保信息来源的可靠性。 
     
- 哈希算法：也叫散列函数，可以通过它将数据量较大的消息或者数据计算出一个格式固定，
  数据量较小的数字摘要，也叫指纹，散列值，或者哈希。
  好的哈希算法应该是不可逆的（无法通过数字摘要反推出原来的信息或者数据），
  敏感的（原来数据中任何一个微小的改动，都会使数字摘要发生巨大变化），
  防冲突的（很难找到两个不同的信息，它们的数字摘要相同）。 

- 比特币里的公钥和私钥：比特币世界里，用来确定比特币归属的是按照比特币协议生成的一对对公钥和私钥，
  它们通过非对称加密算法（椭圆曲线算法）生成，公钥通过两次哈希算法（SHA256）运算得到一个散列值（也叫做哈希），
  再经过Base58Check编码生成了我们常见到的比特币的钱包地址。**所以钱包地址经过解码后，就可以得到对应公钥的哈希**，
  可以用于验证私钥签名，加密数据等等。
  
- **UTXO**：Unspent transaction output，未花费的交易输出，它是比特币世界里的抽象货币，
  每个UTXO都被一个公钥（钱包地址）锁定，只有持有该公钥对应私钥的人，可以通过私钥签名（解锁）并使用该UTXO。
  可以把UTXO理解为抽象的纸币，但它的面值不是固定的（不光有5块，10块，可以是任何数）。 


抛开代码，我们接下来看看比特币的交易是怎样的一个过程：
1. 有甲、乙、丙、丁四个人，他们都有比特币钱包，钱包私钥自己持有，钱包地址（由各自钱包公钥生成）在比特币网络公开，用于UTXO的锁定和验证。
2. 起始，甲给丙0.7BTC，在比特币网络里的记录是UTXO(1)：
   甲给丙0.7BTC；乙给丙0.5BTC，在比特币网络里的记录是UTXO(2)：
   乙给丙0.5BTC。 
   此时，丙的比特币钱包的账户余额为这两个UTXO之和，丙的比特币总数=UTXO(1)+UTXO(2)=1.2BTC

这天，丙向丁买了一批货物，需要向丁支付0.8BTC。 丙通过比特币网络向丁转账，但丙现有的两个UTXO均不足0.8BTC，需要将两个UTXO一起使用，类似现金交易：给丁支付1.2BTC，丁找给丙0.4BTC。但在比特币网络中，这个找零的工作是由丙自己发起的。

整个交易的流程如下：
1. 丙通过比特币钱包准备交易信息，交易信息包括输入和输出两个部分：
   - 输入是UTXO(1)和UTXO(2)， 以及丙的钱包私钥签名（因为UTXO(1)和UTXO(2)均被丙的钱包公钥锁定，需要通过丙的私钥签名来解锁后，进行使用）
   - 交易的输出是未确认的UTXO(3)：丙给丁0.8BTC，这个新的UTXO指向丁的钱包公钥，待交易确认后，将被丁的钱包公钥锁定。 
     此时还有0.4BTC需要找零给丙，因此还需要输出一个未确认的UTXO(4): 丙给丙0.3999BTC，
     这个新的UTXO指向丙的钱包公钥，待交易确认后，将被丙的钱包公钥锁定。
     
> 为什么找零的数额不是0.4BTC呢？因为比特币网络要求，交易转账，需要向比特币网络支付交易手续费。
> 剩余0.0001BTC未指向任何钱包公钥，将作为转账手续费支付给打包这笔交易的矿工
> （如果未找零，剩余所有未指定的比特币将全部作为手续费给打包交易的矿工，不过目前找零工作都由钱包自动完成，不用担心）。

2. 交易信息准备完毕后，经过丙的钱包验证交易合法（UTXO合法，签名有效，输入输出金额有效等等）后，
   将交易广播到比特币网络中，由挖矿节点验证交易后，打包交易（将交易记入比特币区块中），并向比特币网络广播，交易完成。
   
3. 旧的UTXO被消耗，新的UTXO开始生效。此时：
   - 丁的钱包里有一个未使用的UTXO(3): 丙给丁0.8BTC 
   - 丙的钱包里有一个未使用的UTXO(4): 丙给丙0.3999BTC。


以上是较为抽象的比特币交易的过程，有关比特币交易的构造，签名验证，节点验证，交易广播，加入挖矿节点mempool，
矿工构造预备区块，以及最终的出块确认的过程，后续会分别介绍，本篇不做展开。

从这个抽象的交易过程，我们可以发现，**比特币的交易实质上是一堆UTXO的输入和输出的过程**，
伴随旧的UTXO被消耗，新的UTXO产生，完成了一次又一次的比特币交易。
交易的过程由非对称加密和哈希算法进行双重保护，比特币持有者可以放心完成交易而不必担心身份被泄露，
交易过程中也消耗了一部分比特币，用于奖励打包交易的矿工，使矿工乐于完成自己维护比特币网络的任务。